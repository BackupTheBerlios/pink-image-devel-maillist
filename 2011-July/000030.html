<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Pink-image-devel] Numpy to pink and back
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/pink-image-devel/2011-July/index.html" >
   <LINK REL="made" HREF="mailto:pink-image-devel%40lists.berlios.de?Subject=Re%3A%20%5BPink-image-devel%5D%20Numpy%20to%20pink%20and%20back&In-Reply-To=%3C201107122324.22837.ujoimro%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000028.html">
   <LINK REL="Next"  HREF="000029.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Pink-image-devel] Numpy to pink and back</H1>
    <B>Laszlo Marak</B> 
    <A HREF="mailto:pink-image-devel%40lists.berlios.de?Subject=Re%3A%20%5BPink-image-devel%5D%20Numpy%20to%20pink%20and%20back&In-Reply-To=%3C201107122324.22837.ujoimro%40gmail.com%3E"
       TITLE="[Pink-image-devel] Numpy to pink and back">ujoimro at gmail.com
       </A><BR>
    <I>Tue Jul 12 23:24:20 CEST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="000028.html">[Pink-image-devel] Numpy to pink and back
</A></li>
        <LI>Next message: <A HREF="000029.html">[Pink-image-devel] Numpy to pink and back
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30">[ date ]</a>
              <a href="thread.html#30">[ thread ]</a>
              <a href="subject.html#30">[ subject ]</a>
              <a href="author.html#30">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello, 
sorry for the delay, I'll look it up tomorrow, thank You

----- &lt;begin original message&gt; -----
Date: 2011-07-07T09:50:56Z
From: Jerome Ferrari &lt;Jerome Ferrari &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/pink-image-devel">zonderrr at gmail.com</A>&gt;&gt;
To: <A HREF="https://lists.berlios.de/mailman/listinfo/pink-image-devel">pink-image-devel at lists.berlios.de</A>
Cc: 
Subject: Re: [Pink-image-devel] Numpy to pink and back

&gt;<i> Hi Laszlo,
</I>&gt;<i> 
</I>&gt;<i> I believe that what you look for is the *ravel *method.
</I>&gt;<i> import numpy
</I>&gt;<i> #create a 2x2 image
</I>&gt;<i> a = numpy.ndarray(shape=(2,2), dtype=float, order='F')
</I>&gt;<i> a.fill(0) #to know what is inside
</I>&gt;<i> b = a.*ravel*()
</I>&gt;<i> 
</I>&gt;<i> print(a)
</I>&gt;<i> [[ 0.  0.]
</I>&gt;<i>  [ 0.  0.]]
</I>&gt;<i> 
</I>&gt;<i> print(b)
</I>&gt;<i> [ 0.  0.  0.  0.]
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 2011/7/7 Laszlo Marak &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/pink-image-devel">ujoimro at gmail.com</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> &gt; My problem is, that numpy does not hold it's values as a single array. I
</I>&gt;<i> &gt; can
</I>&gt;<i> &gt; make a constructor which takes a pointer and converts it into pink image,
</I>&gt;<i> &gt; if
</I>&gt;<i> &gt; You can convert the numpy array into a simple array. Something like:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; A = numpy.array(...)
</I>&gt;<i> &gt; I = pink.char_image([size_x, size_y], make_pointer_from_numpy(A))
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; If there is no method to do that in Python, then one needs to use the
</I>&gt;<i> &gt; numpy api.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; ----- &lt;begin original message&gt; -----
</I>&gt;<i> &gt; Date: 2011-07-06T16:53:08Z
</I>&gt;<i> &gt; From: Jerome Ferrari &lt;Jerome Ferrari &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/pink-image-devel">zonderrr at gmail.com</A>&gt;&gt;
</I>&gt;<i> &gt; To: Fajardo, <A HREF="https://lists.berlios.de/mailman/listinfo/pink-image-devel">Ottopink-image-devel at lists.berlios.de</A>
</I>&gt;<i> &gt; Cc: <A HREF="https://lists.berlios.de/mailman/listinfo/pink-image-devel">pink-image-devel at lists.berlios.depink-image-devel</A>@lists.berlios.de
</I>&gt;<i> &gt; Subject: Re: [Pink-image-devel] Numpy to pink and back
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; &gt; Sorry, I just realized I didn't replied to all before, I'll try to
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; improve.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; &gt; 2011/7/6 Fajardo, Otto &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/pink-image-devel">otto.fajardo at fmi.ch</A>&gt;
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; **
</I>&gt;<i> &gt; &gt; &gt; Yes, your method for getting it from pink to scipy looks interesting.
</I>&gt;<i> &gt; &gt; &gt; I think I cant benefit from it, because I am working (forced to work
</I>&gt;<i> &gt; &gt; &gt; actually), so your trick wouldn't be avaiable ...
</I>&gt;<i> &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; For now anyway, I am happy with scipy getting the image from the
</I>&gt;<i> &gt; &gt; &gt; buffer as I work with binary images ...
</I>&gt;<i> &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; Now, back to numpy to pink:
</I>&gt;<i> &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; 1- I found it's possible to write an image to a file-like object , so
</I>&gt;<i> &gt; &gt; &gt; that you don't have to write it to the disk or use a pipe. First use
</I>&gt;<i> &gt; &gt; &gt; temp = tempfile.TemporaryFile, and then if you have your image in PIL
</I>&gt;<i> &gt; &gt; &gt; format, just saying yourimage.save(temp,'format'), you get it to the
</I>&gt;<i> &gt; &gt; &gt; temp. Now the thing would be to use the pink.cpp.readimage to grab
</I>&gt;<i> &gt; &gt; &gt; the image from this temporary file, but apparently it only accepts a
</I>&gt;<i> &gt; &gt; &gt; string with the name of the file as argument and not an object ...
</I>&gt;<i> &gt; &gt; &gt; or maybe there is a way? any idea?
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; &gt; I don't see the interest of that trick, it doesn't modify the format.
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; 2- there is this intriguing class, pink.np. There there is a method
</I>&gt;<i> &gt; &gt; &gt; pink.np.frombuffer. If you use this you can get the data from the
</I>&gt;<i> &gt; &gt; &gt; numpy array to pink ... but apparently it still is a numpy array.
</I>&gt;<i> &gt; &gt; &gt; Maybe there is a way in pink from internally convert this numpy
</I>&gt;<i> &gt; &gt; &gt; object to a char image?
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; &gt; intriguing class indeed. It seems to deliver exactly numpy.
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; 3- I manage to get the for loops working on cython. It makes the
</I>&gt;<i> &gt; &gt; &gt; thing
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; a
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; &gt; &gt; bit faster, but sill is slower than writing the image to the disk and
</I>&gt;<i> &gt; &gt; &gt; then retrieving it, so, no use for it.
</I>&gt;<i> &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; Otto
</I>&gt;<i> &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt;  ------------------------------
</I>&gt;<i> &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; *From:* Jerome Ferrari [mailto:<A HREF="https://lists.berlios.de/mailman/listinfo/pink-image-devel">zonderrr at gmail.com</A>]
</I>&gt;<i> &gt; &gt; &gt; *Sent:* Wednesday, July 06, 2011 3:22 PM
</I>&gt;<i> &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; *To:* Fajardo, Otto
</I>&gt;<i> &gt; &gt; &gt; *Subject:* Re: [Pink-image-devel] Numpy to pink and back
</I>&gt;<i> &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; 2011/7/6 Fajardo, Otto &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/pink-image-devel">otto.fajardo at fmi.ch</A>&gt;
</I>&gt;<i> &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt; **
</I>&gt;<i> &gt; &gt; &gt;&gt; Hi Jerome,
</I>&gt;<i> &gt; &gt; &gt;&gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt; your code from pink to scipy works for my images, nice!!!
</I>&gt;<i> &gt; &gt; &gt;&gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt; now the problem is how to import the images from numpy to pink ...
</I>&gt;<i> &gt; &gt; &gt;&gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt; I think the problem is the pink image is not just raw data but is
</I>&gt;<i> &gt; &gt; &gt;&gt; compressed or encoded in some way I don't understand. Therefore, you
</I>&gt;<i> &gt; &gt; &gt;&gt; need to encode the data first before put it into the pink image (in
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; the
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt; case of your code, the get_pixels method is decoding from the pink
</I>&gt;<i> &gt; &gt; &gt;&gt; to raw pixel data). I guess without this decoding, the whole thing
</I>&gt;<i> &gt; &gt; &gt;&gt; will fail. As an example, you can get the buffer data from a numpy
</I>&gt;<i> &gt; &gt; &gt;&gt; array, just by the buit in method data: mynumpyarray.data. But
</I>&gt;<i> &gt; &gt; &gt;&gt; then, if you try to write it to the pink image, it fails.
</I>&gt;<i> &gt; &gt; &gt;&gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt; So, I think we really need some help from the pink experts for a
</I>&gt;<i> &gt; &gt; &gt;&gt; function to import from numpy/scipy to pink.
</I>&gt;<i> &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; I think so too.
</I>&gt;<i> &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt; Another option I am thinking, is to first convert the image to image
</I>&gt;<i> &gt; &gt; &gt;&gt; (scipy.misc.toimage), then, save it as a pgm image
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; (scipy.misc.imsave),
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt; and then load this pgm image into pink (pink.cpp.readimage). This
</I>&gt;<i> &gt; &gt; &gt;&gt; works, and is about 25 times faster than the for loops. Of course
</I>&gt;<i> &gt; &gt; &gt;&gt; it's very silly to write an image to the disk each time you want to
</I>&gt;<i> &gt; &gt; &gt;&gt; do this convertion,
</I>&gt;<i> &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; It is not that silly, maybe just inelegant. If you look in the source
</I>&gt;<i> &gt; &gt; &gt; code of ndimage, they do this kind of trick.
</I>&gt;<i> &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt;  and therefore would be nice to save the image in an object or pipe,
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; and
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt; then open it with pink, again from the object or pipe. I don't know
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; how
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt; to do this, and I don't know if it would work.
</I>&gt;<i> &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; To speed up things, it might be a good idea to dump the image in the
</I>&gt;<i> &gt; &gt; &gt; /dev/shm directory. As far as I understood, it is a directory mounted
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; in
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; &gt; &gt; RAM.
</I>&gt;<i> &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; Another issue is when you need more than 8 bit. As far as I know,
</I>&gt;<i> &gt; &gt; &gt; Pink only read and write PGM and PGM only accept 8 bit. Pink has
</I>&gt;<i> &gt; &gt; &gt; developped its own PGM format to be able to handle 16 bit integer or
</I>&gt;<i> &gt; &gt; &gt; float for instance. But this pink format is not readable by scipy.
</I>&gt;<i> &gt; &gt; &gt; The only other software able to read that is G'mic
</I>&gt;<i> &gt; &gt; &gt; &lt;<A HREF="http://gmic.sourceforge.net/">http://gmic.sourceforge.net/</A>&gt;, which doesn't run under python, it
</I>&gt;<i> &gt; &gt; &gt; thus has to be used with
</I>&gt;<i> &gt; &gt; &gt; subprocess.Popen.
</I>&gt;<i> &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; But still, there are some issues in the way scipy.misc.imsave works:
</I>&gt;<i> &gt; &gt; &gt; it modify the data to recreate an 8 bit thing stretched from 0 to
</I>&gt;<i> &gt; &gt; &gt; 255.
</I>&gt;<i> &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; Anyway, at the end, the idea would be from  pink to scipy:
</I>&gt;<i> &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; *import subprocess
</I>&gt;<i> &gt; &gt; &gt; import pink.cpp as pink
</I>&gt;<i> &gt; &gt; &gt; import scipy
</I>&gt;<i> &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; #create a 32bit int image :
</I>&gt;<i> &gt; &gt; &gt; test_image = pink.int_image([50,50])
</I>&gt;<i> &gt; &gt; &gt; #to be sure to be out a 8bit range :
</I>&gt;<i> &gt; &gt; &gt; test_image[0]=256
</I>&gt;<i> &gt; &gt; &gt; test_image.writeimage(&quot;/dev/shm/tmp.pnk&quot;)
</I>&gt;<i> &gt; &gt; &gt; subprocess.Popen(&quot;gmic /dev/shm/tmp.pnk -o
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; /dev/shm/tmp.png&quot;,shell=True)
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; &gt; &gt; *
</I>&gt;<i> &gt; &gt; &gt; .pnk is the extension name chosen by G'mic as the pink format
</I>&gt;<i> &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt; any idea?
</I>&gt;<i> &gt; &gt; &gt;&gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt; Otto
</I>&gt;<i> &gt; &gt; &gt;&gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt;  ------------------------------
</I>&gt;<i> &gt; &gt; &gt;&gt;  *From:* Jerome Ferrari [mailto:<A HREF="https://lists.berlios.de/mailman/listinfo/pink-image-devel">zonderrr at gmail.com</A>]
</I>&gt;<i> &gt; &gt; &gt;&gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt; *Sent:* Tuesday, July 05, 2011 2:05 PM
</I>&gt;<i> &gt; &gt; &gt;&gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt; *To:* Fajardo, Otto
</I>&gt;<i> &gt; &gt; &gt;&gt; *Subject:* Re: [Pink-image-devel] Numpy to pink and back
</I>&gt;<i> &gt; &gt; &gt;&gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt;   2011/7/5 Fajardo, Otto &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/pink-image-devel">otto.fajardo at fmi.ch</A>&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; **
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; Hi Jerome,
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; quite interesting. is your code working?
</I>&gt;<i> &gt; &gt; &gt;&gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt; I thought so when I pasted this code in the bug tracker, but since
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; then
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt; I think I found a case that did not work properly. It probably has
</I>&gt;<i> &gt; &gt; &gt;&gt; to be refined at least. Maybe it works as it is for your video
</I>&gt;<i> &gt; &gt; &gt;&gt; problems, you are invited to test :)
</I>&gt;<i> &gt; &gt; &gt;&gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;  maybe we can join efforts to write something ?
</I>&gt;<i> &gt; &gt; &gt;&gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt; I would sure be interested in the solution, but I don't know much
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; about
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt; computing, I just started python this year. I actually just copied
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; what
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt; is done in the pil_photoimage.py file.
</I>&gt;<i> &gt; &gt; &gt;&gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt; I think I understand the idea behind weave, it is supposed to
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; accelerate
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt; the &quot;code&quot;, I can't help with that high level thing.
</I>&gt;<i> &gt; &gt; &gt;&gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt; Another solution is to go on with the &quot;buffer format&quot; like in the *
</I>&gt;<i> &gt; &gt; &gt;&gt; pink_to_ndimage* function I wrote, but I don't know how to transform
</I>&gt;<i> &gt; &gt; &gt;&gt; a NDimage into a buffer nor how to read a buffer with pink. If
</I>&gt;<i> &gt; &gt; &gt;&gt; someone
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; has
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt; an idea?
</I>&gt;<i> &gt; &gt; &gt;&gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt; Jerome
</I>&gt;<i> &gt; &gt; &gt;&gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;  Otto
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;  
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;  ------------------------------
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; *From:* Jerome Ferrari [mailto:<A HREF="https://lists.berlios.de/mailman/listinfo/pink-image-devel">zonderrr at gmail.com</A>]
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; *Sent:* Monday, July 04, 2011 6:25 PM
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; *To:* Fajardo, Otto
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; *Subject:* Re: [Pink-image-devel] Numpy to pink and back
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;   Hi,
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; I don't have time to test your weave, but i already filed a feature
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; request about that:
</I>&gt;<i> &gt; <A HREF="http://developer.berlios.de/feature/?func=detailfeature&amp;feature_id=5360">http://developer.berlios.de/feature/?func=detailfeature&amp;feature_id=5360</A>
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; &amp;group_id=12429
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; with something done about it, but not much:
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; def pink_to_ndimage(image):
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;     if type(image) == pink.char_image:
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;         return
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; scipy.frombuffer(image.get_pixels(),'int8').reshape(image.size[1],image
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; .size[0])
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;     elif type(image) == pink.float_image:
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;         return
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; scipy.frombuffer(image.get_pixels(),'float32').reshape(image.size[1],im
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; age.size[0])
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;     elif type(image) == pink.int_image:
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;         return
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; scipy.frombuffer(image.get_pixels(),'int32').reshape(image.size[1],imag
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; e.size[0])
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;     else :
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;         print(&quot;format non-detecte&quot;)
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; 2011/7/4 Fajardo, Otto &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/pink-image-devel">otto.fajardo at fmi.ch</A>&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; Hello,
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; I'm new to pink. I got my images as numpy arrays (because I'm
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; extracting them from videos, and then doing some pre-processing on
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; open cv and scipy-numpy), and would like an efficient way to
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; convert this numpy arrays to pink char images. Laszlo already
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; pointed me at
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; a
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; solution that works, using for loops in python, but it's a bit
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; slow. Does anyone have a solution? Would it be possible to
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; implement such
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; a
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; feature in pink. If yes, the way back to numpy would be necessary
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; as well.
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; I was trying also to write it using scipy.weave, but for some
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; reason it fails, any suggestion?
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; My code looks like this:
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; #bwtest is the binary image I would like to convert to pink.
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; Size_x and size_y are the x and y dimensions of bwtest.
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; I=pink.cpp.char_image([size_x,size_y])
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; code = '''
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;        int i;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;        int m;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;        
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;        for (i=0; i &lt;size_x; ++i){
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;        
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;            for (m=0; m&lt;size_y;++m){
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;            
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;                 I(i,m) = bwtest(m,i);
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;             
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;             }
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;        
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;        }
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;        '''
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; err = weave.inline(code,
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; arg_names=['size_x','size_y','bwtest','I'],
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;                   type_converters=weave.converters.blitz,
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;                   compiler = 'gcc')
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; Many thanks!
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; _______________________________________________
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; Pink-image-devel mailing list
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; <A HREF="https://lists.berlios.de/mailman/listinfo/pink-image-devel">Pink-image-devel at lists.berlios.de</A>
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; <A HREF="https://lists.berlios.de/mailman/listinfo/pink-image-devel">https://lists.berlios.de/mailman/listinfo/pink-image-devel</A>
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Laszlo MARAK
</I>&gt;<i> &gt; Phd. student of ESIEE
</I>&gt;<i> &gt; email: <A HREF="https://lists.berlios.de/mailman/listinfo/pink-image-devel">ujoimro at gmail.com</A>
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; At the source of every error which is blamed on the computer you will
</I>&gt;<i> &gt; find at
</I>&gt;<i> &gt; least two human errors, including the error of blaming it on the
</I>&gt;<i> &gt; computer.
</I>Laszlo MARAK
Phd. student of ESIEE
email: <A HREF="https://lists.berlios.de/mailman/listinfo/pink-image-devel">ujoimro at gmail.com</A>

You worry too much about your job. Stop it. You're not paid enough to worry.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000028.html">[Pink-image-devel] Numpy to pink and back
</A></li>
	<LI>Next message: <A HREF="000029.html">[Pink-image-devel] Numpy to pink and back
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30">[ date ]</a>
              <a href="thread.html#30">[ thread ]</a>
              <a href="subject.html#30">[ subject ]</a>
              <a href="author.html#30">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/pink-image-devel">More information about the Pink-image-devel
mailing list</a><br>
</body></html>
